title: Node.js学习笔记：简介
date: 2014-09-30 15:00:12
categories:
- 技术
- Web前端
- NodeJS
tags:
- Node.js
---

Node.js应该是当今最火热的技术之一。本文主要介绍Node.js的特点及应用场景。

<!-- more -->

Node.js是一个基于Chrome JavaScript运行时建立的一个平台，用来方便地搭建快速的 易于扩展的网络应用。Node.js借助事件驱动，非阻塞I/O模型变得轻量和高效，非常适合 运行在分布式设备的数据密集型实时应用。

# 1. 特点

## 1.1 异步I/O

所谓的异步I/O，是相对同步I/O而言的。程序执行过程中必然要进行很多I/O操作，如读写文件、输入输出、请求响应等等。通常来说，I/O操作是非常费时的。例如在传统的编程模式中，你要读一个几G的文件，整个线程都暂停下来，等待文件读完后继续执行。换言之，I/O操作阻塞了代码的执行，极大地降低了程序的效率。

关于异步I/O，其实对于前端工程师来说并不陌生，因为发起Ajax请求就是最常见的一种“异步”调用。在Node中，以读取文件（读文件是一种耗时的I/O操作）为例，它与发起Ajax请求的写法很像：

    var fs = require('fs');
    fs.readFile('/path', function(err, file) {
        console.log('读取文件完成');
    });
    console.log('开始读取文件');

上述代码在调用`fs.readFile`后，后续代码是被立即执行的，“读取文件完成”的时刻是无法预知的。当线程遇到I/O操作时不会以阻塞的方式等待I/O操作结束，而只是将I/O请求发送给操作系统，继续执行后续语句。当操作系统完成I/O操作时以事件的形式通知执行I/O操作的线程，线程会在特定时间处理这个事件。

## 1.2 事件循环与回调函数

所谓事件循环是指Node会把所有的异步操作使用事件机制解决，有个线程在不断地循环检测事件队列。事件循环会检查事件队列中有没有未处理的事件，直到程序结束。事件的编程方式具有轻量级、松耦合、只关注事务点等优势，但是在多个异步任务的场景下，事件与事件之间各自独立，如何协作是一个问题。在Javascript中，回调函数无处不在，回调函数是最好的接受异步调用返回数据的方式。

## 1.3 单线程

Node保持了JS在浏览器中单线程的特点。单线程的最大好处是不用像多线程编程那样出处在意状态的同步问题，没有死锁的存在，也没有线程上下文切换的开销。单线程也有其弱点，主要表现在三方面：无法利用多核CPU；错误会引起整个应用退出，应用的健壮性值得考研；大量计算会占用CPU导致无法继续调用异步I/O。

为了解决上述问题，Node采用了与HTML5 Web Workers相同的思路，使用`child_process`来解决但单线程中大计算量的问题。通过将计算分发到各个子进程，可以将大量计算分解掉，然后再通过进程之间的事件消息来传递结果。

## 1.4 跨平台

Node是跨平台的，即同样的一套JS代码都可以部署运行在Windows、Linux、OSX等平台。这主要得益于Node在操作系统与Node上层模块系统之间构建了一层平台层架构libuv。

![Node实现跨平台的架构示意图](http://raytaylorlin-blog.qiniudn.com/image%2Fnodejs%2FNode%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.jpg)

# 2. 应用场景

* 实时应用：如在线聊天，实时通知推送等等（如[socket.io](http://socket.io/)）
* 分布式应用：通过高效的并行I/O使用已有的数据
* 工具类应用：海量的工具，小到前端压缩部署（如[grunt](gruntjs.com)），大到桌面图形界面应用程序
* 游戏类应用：游戏领域对实时和并发有很高的要求（如网易的[pomelo](pomelo.netease.com)框架）
* 利用稳定接口提升Web渲染能力
* 前后端编程语言环境统一：前端开发人员可以非常快速地切入到服务器端的开发（如著名的纯Javascript全栈式[MEAN](http://mean.io)架构）

参考资料：《深入浅出NodeJS》第一章
